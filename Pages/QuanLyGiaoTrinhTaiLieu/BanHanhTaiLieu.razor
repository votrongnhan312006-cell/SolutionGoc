@page "/BanHanhGTTL"
@using QLCongViec.Models
@using api.Models.QLBienSoan
@inject DialogService DialogService

<div class="container-fluid">
    <h3>3. Ban h√†nh gi√°o tr√¨nh</h3>
    <p class="text-muted">Qu·∫£n l√Ω vi·ªác ban h√†nh c√°c t√†i li·ªáu ƒë√£ th·∫©m ƒë·ªãnh ƒë·∫°t</p>

    <div class="row">
        <!-- C·ªôt tr√°i: Danh s√°ch -->
        <div class="col-md-4">
            <RadzenCard>
                <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">T·∫•t c·∫£</RadzenText>
                <div class="list-group">
                    @foreach (var item in lstGTTL)
                    {
                        <div class="list-group-item list-group-item-action @(selectedItem == item ? "active-item" : "")"
                             @onclick="() => SelectItem(item)" style="cursor: pointer; border-left: 5px solid @(item.TenGTTL == "Ch·ªù ban h√†nh" ? "#ffc107" : "green"); margin-bottom: 5px;">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">@item.TenGTTL</h6>


                                @* <RadzenBadge BadgeStyle="BadgeStyle.Warning" Text="@item.IdTinhTrang" /> *@
                            
                            
                            </div>
                            <small>@item.ChuBien</small><br />
                            <small class="text-muted">@item.IdDonVi</small><br />
                            <small>Th·∫©m ƒë·ªãnh: @item.NgayThamDinh?.ToString("dd/MM/yyyy")</small>
                        </div>
                    }
                </div>
            </RadzenCard>
        </div>

        <!-- C·ªôt ph·∫£i: Chi ti·∫øt -->
        <div class="col-md-8">
            @if (selectedItem != null)
            {
                <RadzenCard>
                    <RadzenText TextStyle="TextStyle.H6">Th√¥ng tin t√†i li·ªáu</RadzenText>
                    <div class="row">
                        <div class="col-md-6">
                            <RadzenText TextStyle="TextStyle.Subtitle2">M√£ t√†i li·ªáu</RadzenText>
                            <p><b>@selectedItem.MaTaiLieu</b></p>

                            <RadzenText TextStyle="TextStyle.Subtitle2">T√™n t√†i li·ªáu</RadzenText>
                            <p>@selectedItem.TenGTTL</p>


                            @* <RadzenText TextStyle="TextStyle.Subtitle2">ƒê∆°n v·ªã</RadzenText>
                            <p>@selectedItem.idDonVi</p> *@


                        </div>
                        <div class="col-md-6">
                            <RadzenText TextStyle="TextStyle.Subtitle2">Tr·∫°ng th√°i</RadzenText>


                            @* <RadzenBadge BadgeStyle="BadgeStyle.Warning" Text="@selectedItem.IdTinhTrang" /> *@


                            <RadzenText TextStyle="TextStyle.Subtitle2" Class="mt-3">Ch·ªß bi√™n</RadzenText>
                            <p>@selectedItem.ChuBien</p>

                            <RadzenText TextStyle="TextStyle.Subtitle2">Ng√†y th·∫©m ƒë·ªãnh</RadzenText>
                            <p>@selectedItem.NgayThamDinh?.ToString("dd/MM/yyyy")</p>
                        </div>
                    </div>

                    <RadzenStack Orientation="Orientation.Vertical" Gap="0.5rem" Class="mt-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2">T√†i li·ªáu li√™n quan</RadzenText>
                        <RadzenLink Path="#" Text="üìÑ B·∫£n th·∫£o ho√†n thi·ªán" />
                        <RadzenLink Path="#" Text="üìÑ Bi√™n b·∫£n th·∫©m ƒë·ªãnh" />
                        <RadzenLink Path="#" Text="üìÑ Quy·∫øt ƒë·ªãnh giao nhi·ªám v·ª•" />
                    </RadzenStack>

                    <div class="mt-4">
                        <RadzenButton Text="Nh·∫≠p th√¥ng tin ban h√†nh" Icon="check_circle" ButtonStyle="ButtonStyle.Success"
                                      Click="OpenBanHanhDialog" Class="w-100" />
                    </div>
                </RadzenCard>
            }
            else
            {
                <RadzenCard>
                    <p class="text-center text-muted">Vui l√≤ng ch·ªçn m·ªôt ƒë·ªÅ t√†i ƒë·ªÉ xem chi ti·∫øt.</p>
                </RadzenCard>
            }
        </div>
    </div>
</div>

<style>
    .active-item {
        background-color: #f0f8ff;
        border-color: #007bff;
    }
</style>

@inject ApiServices apiService
@code {
    private List<tbGTTL>? lstGTTL = new();
    private tbGTTL? selectedItem;

    protected override async Task OnInitializedAsync()
    {
        lstGTTL = await apiService.GetAll<tbGTTL>();
    }

    void SelectItem(tbGTTL item)
    {
        selectedItem = item;
    }

    async Task OpenBanHanhDialog()
    {
        var result = await DialogService.OpenAsync<NhapThongTinBanHanhTaiLieu_Dialog>(
            $"Nh·∫≠p th√¥ng tin ban h√†nh",
            new Dictionary<string, object>() { { "TaiLieuId", selectedItem.IdGTTL }, { "TenTaiLieu", selectedItem.TenGTTL } },
            new DialogOptions() { Width = "700px", Height = "auto" });

        if (result is bool ok && ok)
        {
            // Reload l·∫°i danh s√°ch sau khi l∆∞u th√†nh c√¥ng
            StateHasChanged();
        }
    }
}

@page "/admin/QLNhom"
@inject ClientServices client
<style>
.rz-label {
margin-bottom: 0;
font-weight: bold;
}

.rz-column-title-content {
font-weight: bold;
}
</style>

<LoadingIndicator IsLoading ="@isLoading" />

<TableAPI @ref=grd TItem="tbNhom"
  TableTitle=@tableTitle
  FormTitle=@formTitle
  OnDelete="@(args => Delete((tbNhom)args))" 
  OnAdd="@(args => Add((tbNhom)args))" 
  isSearch=false ShowClose=true
  OnLoadingChanged="HandleTableLoadingChanged">

<MoreColumns>
<RadzenDataGridColumn TItem="tbNhom" Title="Tên nhóm" TextAlign="TextAlign.Left" Sortable="false" Width="200px"
  Property="TenNhom" Frozen="true">
</RadzenDataGridColumn>
<RadzenDataGridColumn TItem="tbNhom" Title="Mô tả nhóm" TextAlign="TextAlign.Left" Sortable="false" Width="100%"
  Property="MoTa" Frozen="true">
</RadzenDataGridColumn>
</MoreColumns>
<FormDialog Context="ctx">
<QLNhom_Detail Record="ctx" />
</FormDialog>
</TableAPI>

@code {
[CascadingParameter] private Task<AuthenticationState> authenticationState { get; set; } = default!;

TableAPI<tbNhom> grd = default!;
string tableTitle = "DANH SÁCH NHÓM NGƯỜI DÙNG";
string formTitle = "THÔNG TIN NHÓM NGƯỜI DÙNG";
string lamda;
// 2 cờ loading
bool isSelfLoading = false;   // cha đang khởi tạo / xử lý
bool isTableLoading = false;  // TableAPI đang load

// Biến điều khiển trạng thái Loading
bool isLoading => isSelfLoading || isTableLoading;

protected override async Task OnInitializedAsync()
{

// Bắt đầu các công việc khởi tạo cha
isSelfLoading = true;
//isRadzenLoading = true;
StateHasChanged();
try
{
// TODO: việc khởi tạo của cha (gọi API, load dữ liệu, v.v.)
// ví dụ:
// var userInfo = await client.GetUserInfo();
// user = userInfo.Data;

await Task.Delay(500); // demo thôi, bạn thay bằng code thật
}
finally
{
isSelfLoading = false;
StateHasChanged();
}
}
// Nhận sự kiện loading từ TableAPI
void HandleTableLoadingChanged(bool loading)
{
isTableLoading = loading;
StateHasChanged();
}


protected async Task Delete(tbNhom record)
{
//isRadzenSearching = true;
lamda = $"IdNhom == {record.IdNhom}";
await client.apiSevices.Delete<tbNhom>(lamda);
}
protected async Task Add(tbNhom record)
{
await grd.Refresh();
}
}
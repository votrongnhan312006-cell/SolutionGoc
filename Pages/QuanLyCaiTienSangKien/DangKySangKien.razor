@page "/DangKySkct"
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms
@using QLCongViec.Models.SangKienCaiTien
@using Radzen
@using Radzen.Blazor

<RadzenTemplateForm Data="@sangkien"
                    TItem="tbSangKienCaiTien"
                    Submit="@OnSubmit">

    <RadzenCard Style="max-width:800px;margin:auto;padding:24px;">
        <h3>Đăng ký quản lý sáng kiến / cải tiến</h3>

        <!-- 1. Tác giả -->
        <RadzenLabel Text="1. Họ và tên cá nhân (nhóm) thực hiện *" 
                     Style="margin-top:16px;display:block;" />
        <div class="row">
            <div class="col">
                <RadzenTextBox Name="TacGia"
                               @bind-Value="sangkien.tenTacGia"
                               Placeholder="Tác giả"
                               Style="width:100%" />
                <RadzenRequiredValidator Component="TacGia"
                                         Text="Vui lòng nhập tác giả" />
            </div>
            <div class="col">
                <RadzenTextBox @bind-Value="sangkien.capBacTacGia"
                               Placeholder="Cấp bậc, chức vụ"
                               Style="width:100%" />
            </div>
        </div>

        <div class="row" style="margin-top:8px">
            <div class="col">
                <RadzenTextBox @bind-Value="sangkien.tenDongTacGia"
                               Placeholder="Đồng tác giả"
                               Style="width:100%" />
            </div>
            <div class="col">
                <RadzenTextBox @bind-Value="sangkien.capBacDongTacGia"
                               Placeholder="Cấp bậc, chức vụ"
                               Style="width:100%" />
            </div>
        </div>

        @* <!-- 2. Đơn vị -->
        <RadzenLabel Text="2. Đơn vị thực hiện" 
                     Style="margin-top:16px;display:block;" />
        <RadzenTextBox @bind-Value="sangkien.d"
                       Placeholder="Ví dụ: Khoa CNTT"
                       Style="width:100%" /> *@

        <!-- 3. Tên sáng kiến -->
        <RadzenLabel Text="3. Tên sáng kiến / cải tiến *" 
                     Style="margin-top:16px;display:block;" />
        <RadzenTextBox Name="TenSangKien"
                       @bind-Value="sangkien.tenSangKienCaiTien"
                       Placeholder="Nhập tên sáng kiến"
                       Style="width:100%" />
        <RadzenRequiredValidator Component="TenSangKien"
                                 Text="Vui lòng nhập tên sáng kiến" />

        <!-- 4. File -->
        <RadzenLabel Text="4. Nội dung đăng ký cải tiến (file)" 
                     Style="margin-top:16px;display:block;" />
        <InputFile OnChange="@OnFileChange"
                   accept=".pdf,.doc,.docx,.xls,.xlsx"
                   class="form-control" />
        @if (!string.IsNullOrEmpty(fileMessage))
        {
            <small class="text-muted">@fileMessage</small>
        }

        <!-- 5. Thời gian / địa điểm / phạm vi -->
        <RadzenLabel Text="5. Dự kiến thực hiện" 
                     Style="margin-top:16px;display:block;" />
        <RadzenDatePicker @bind-Value="sangkien.ngayThucHien"
                          DateFormat="dd/MM/yyyy"
                          Placeholder="Chọn ngày thực hiện"
                          Style="width:100%;margin-bottom:8px;" />

        <RadzenTextBox @bind-Value="sangkien.diaDiemThucHien"
                       Placeholder="Địa điểm thực hiện"
                       Style="width:100%;margin-bottom:8px;" />

        <RadzenTextArea @bind-Value="sangkien.phamViThucHien"
                        Placeholder="Phạm vi thực hiện"
                        Rows="3"
                        Style="width:100%" />

        <RadzenButton Text="Gửi đăng ký"
                      ButtonStyle="ButtonStyle.Primary"
                      ButtonType="ButtonType.Submit"
                      Style="margin-top:20px" />
    </RadzenCard>

</RadzenTemplateForm>


@inject AuthenServices authService
@inject ApiServices apiService
@code {
    string? fileMessage;
    public tbSangKienCaiTien? sangkien = new tbSangKienCaiTien();

    protected async Task OnSubmit(tbSangKienCaiTien model)
    {
        var username = await authService.GetUserName();
        model.idSangKienCaiTien = 2;
        await apiService.Create<tbSangKienCaiTien>(model);
    }

    void OnFileChange(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null)
        {
            // sangkien.FileNoiDung = file;
            fileMessage = $"Đã chọn: {file.Name} ({file.Size / 1024} KB)";
        }
    }

    
}
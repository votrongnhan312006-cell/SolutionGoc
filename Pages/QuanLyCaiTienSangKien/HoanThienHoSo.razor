@page "/HoanThienHoSoSkct"
@using Radzen
@using Radzen.Blazor
@using QLCongViec.Models.SangKienCaiTien

<RadzenCard Style="padding:20px">
    <h3>Danh sách sáng kiến cải tiến</h3>
    <h4>Chỉ hiển thị các sáng kiến đã được Hội đồng phê duyệt</h4>
    <p style="color:#6c757d;margin-bottom:20px">
        Hoàn thiện hồ sơ sáng kiến cải tiến
    </p>

    <RadzenDataGrid Data="@dsSangKienDaDuyet"
                    TItem="tbSangKienCaiTien"
                    AllowPaging="true"
                    PageSize="10"
                    AllowSorting="true"
                    AllowFiltering="true">

        <Columns>

            <!-- STT -->
            <RadzenDataGridColumn Title="Số thứ tự"
                                  Width="80px"
                                  TextAlign="TextAlign.Center">
                <Template Context="item">
                    @(dsSangKienDaDuyet.IndexOf(item) + 1)
                </Template>
            </RadzenDataGridColumn>

            <!-- TÊN SÁNG KIẾN -->
            <RadzenDataGridColumn Title="Tên sáng kiến cải tiến"
                                  Width="320px">
                <Template Context="item">
                    <div>
                        @if (CanhBaoThieuHoSo(item))
                        {
                            <RadzenIcon Icon="error"
                                        Style="color:#dc3545;margin-right:8px" />
                        }
                        <strong>@item.tenSangKienCaiTien</strong>
                    </div>

                    @if (!string.IsNullOrEmpty(item.moTa))
                    {
                        <small style="color:#6c757d;display:block;margin-top:4px">
                            @item.moTa
                        </small>
                    }
                </Template>
            </RadzenDataGridColumn>

            <!-- CẤP / LOẠI -->
            <RadzenDataGridColumn Title="Cấp sáng kiến"
                                  Width="160px">
                <Template Context="item">
                    @(item.idCap.HasValue ? $"Cấp {item.idCap}" : "")
                </Template>
            </RadzenDataGridColumn>

            <!-- TÁC GIẢ -->
            <RadzenDataGridColumn Property="tenTacGia"
                                  Title="Tác giả"
                                  Width="180px" />

            <!-- NGÀY THỰC HIỆN -->
            <RadzenDataGridColumn Title="Ngày thực hiện"
                                  Width="130px"
                                  TextAlign="TextAlign.Center">
                <Template Context="item">
                    @(item.ngayThucHien.HasValue
                                        ? item.ngayThucHien.Value.ToString("dd/MM/yyyy")
                                        : "")
                </Template>
            </RadzenDataGridColumn>

            <!-- TRẠNG THÁI -->
            <RadzenDataGridColumn Title="Trạng thái"
                                  Width="160px"
                                  TextAlign="TextAlign.Center">
                <Template>
                    <RadzenBadge Text="Đã phê duyệt"
                                 BadgeStyle="BadgeStyle.Success"
                                 Style="padding:8px 12px" />
                </Template>
            </RadzenDataGridColumn>

            <!-- THAO TÁC -->
            <RadzenDataGridColumn Title="Thao tác"
                                  Width="160px"
                                  TextAlign="TextAlign.Center">
                <Template Context="item">
                    <div style="display:flex;gap:6px;justify-content:center">

                        <RadzenButton Icon="visibility"
                                      Size="ButtonSize.Small"
                                      ButtonStyle="ButtonStyle.Info"
                                      Variant="Variant.Outlined"
                                      title="Chi tiết"
                                      Click="@(() => XemChiTiet(item.idSangKienCaiTien))" />

                        <RadzenButton Icon="edit"
                                      Size="ButtonSize.Small"
                                      ButtonStyle="ButtonStyle.Success"
                                      Variant="Variant.Outlined"
                                      title="Hoàn thiện hồ sơ" />
                                      @* Click="@(() => HoanThienHoSo(item.idSangKienCaiTien))" /> *@
                    </div>
                </Template>
            </RadzenDataGridColumn>

        </Columns>
    </RadzenDataGrid>
</RadzenCard>



@code {

    List<tbSangKienCaiTien> dsSangKienDaDuyet = new();

    protected override void OnInitialized()
    {
        // DEMO DATA – sau này thay bằng API
        dsSangKienDaDuyet = new()
        {
            new tbSangKienCaiTien
            {
                idSangKienCaiTien = 1,
                tenSangKienCaiTien = "Ứng dụng CNTT trong quản lý",
                moTa = "Sáng kiến phục vụ công tác quản lý",
                tenTacGia = "Nguyễn Văn A",
                capBacTacGia = "Đại úy",
                ngayThucHien = DateOnly.FromDateTime(DateTime.Now.AddDays(-10)),
                idCap = 1,
                idTrangThai = 1,
                fileDangKy = null,
                fileKetQua = null
            },
            new tbSangKienCaiTien
            {
                idSangKienCaiTien = 2,
                tenSangKienCaiTien = "Cải tiến quy trình nghiệp vụ",
                moTa = "Nâng cao hiệu quả xử lý hồ sơ",
                tenTacGia = "Trần Văn B",
                capBacTacGia = "Thượng úy",
                ngayThucHien = DateOnly.FromDateTime(DateTime.Now.AddDays(-20)),
                idCap = 2,
                idTrangThai = 1,
                fileDangKy = "dk.pdf",
                fileKetQua = null
            }
        };
    }

    bool CanhBaoThieuHoSo(tbSangKienCaiTien sk)
    {
        // Ví dụ: thiếu file kết quả
        return string.IsNullOrEmpty(sk.fileKetQua);
    }

    void XemChiTiet(int id)
    {
        Console.WriteLine($"Xem chi tiết sáng kiến: {id}");
    }

    // void HoanThienHoSo(int id)
    // {
    //     Console.WriteLine($"Hoàn thiện hồ sơ sáng kiến: {id}");
    // }
}

@page "/HoanThienHoSoSkct"
@using Radzen
@using Radzen.Blazor

<!--==================== PHẦN HTML/MARKUP ====================-->

<RadzenCard Style="padding:20px">
    <h3>Danh sách đề xuất của đơn vị</h3>
    <h3>Trang này chỉ hiện thị những Sáng kiến cải tiến được hội đồng duyệt</h3>
    <p style="color:#6c757d;margin-bottom:20px">Theo dõi trạng thái các đề xuất biên soạn đã gửi</p>

    <RadzenDataGrid Data="@dsDeXuat"
                    TItem="DeXuatDto"
                    AllowPaging="true"
                    PageSize="10"
                    AllowSorting="true"
                    AllowFiltering="true">

        <Columns>

            <!-- STT -->
            <RadzenDataGridColumn Title="Số thứ tự" Width="80px" TextAlign="TextAlign.Center">
                <Template Context="item">
                    @(dsDeXuat.IndexOf(item) + 1)
                </Template>
            </RadzenDataGridColumn>

            <!-- Tên sáng kiến -->
            <RadzenDataGridColumn TItem="DeXuatDto"
                                  Property="TenSangKienCaiTien"
                                  Title="Tên sáng kiến cải tiến"
                                  Width="300px">
                <Template Context="item">
                    <div>
                        @if (item.CoThongBao)
                        {
                            <RadzenIcon Icon="error" Style="color:#dc3545;margin-right:8px" />
                        }
                        <strong>@item.TenSangKienCaiTien</strong>
                    </div>
                    @if (!string.IsNullOrEmpty(item.MoTaGoc))
                    {
                        <small style="color:#6c757d;display:block;margin-top:4px">@item.MoTaGoc</small>
                    }
                </Template>
            </RadzenDataGridColumn>

            <!-- Loại sáng kiến -->
            <RadzenDataGridColumn TItem="DeXuatDto"
                                  Property="LoaiSangKienCaiTien"
                                  Title="Loại sáng kiến cải tiến"
                                  Width="180px" />

            <!-- Tác giả -->
            <RadzenDataGridColumn TItem="DeXuatDto"
                                  Property="TacGia"
                                  Title="Tác giả"
                                  Width="180px" />

            <!-- Ngày gửi -->
            <RadzenDataGridColumn Title="Ngày gửi" Width="120px" TextAlign="TextAlign.Center">
                <Template Context="item">
                    @item.NgayGui.ToString("dd/MM/yyyy")
                </Template>
            </RadzenDataGridColumn>

            <!-- Trạng thái -->
            <RadzenDataGridColumn Title="Trạng thái" Width="180px" TextAlign="TextAlign.Center">
                <Template Context="item">
                    @if (item.TrangThai == 1)
                    {
                        <RadzenBadge Text="Được phê duyệt"
                                     BadgeStyle="BadgeStyle.Success"
                                     Style="padding:8px 12px" />
                    }
                    else if (item.TrangThai == 0)
                    {
                        <RadzenBadge Text="Được phê duyệt"
                                     BadgeStyle="BadgeStyle.Success"
                                     Style="padding:8px 12px" />
                    }
                    else
                    {
                        <RadzenBadge Text="Được phê duyệt"
                                     BadgeStyle="BadgeStyle.Success"
                                     Style="padding:8px 12px" />
                    }
                </Template>
            </RadzenDataGridColumn>

            <!-- Thao tác -->
            <RadzenDataGridColumn Title="Thao tác" Width="160px" TextAlign="TextAlign.Center">
                <Template Context="item">
                    <div style="display:flex;gap:5px;justify-content:center">
                        <!-- Nút Xem chi tiết -->
                        <RadzenButton Icon="visibility"
                                      Size="ButtonSize.Small"
                                      ButtonStyle="ButtonStyle.Info"
                                      Variant="Variant.Outlined"
                                      Click="@(() => XemChiTiet(item.SoThuTu))"
                                      title="Chi tiết" />

                        <!-- Nút Cập nhật -->
                        <RadzenButton Icon="edit"
                                      Size="ButtonSize.Small"
                                      ButtonStyle="ButtonStyle.Success"
                                      Variant="Variant.Outlined"
                                      Click="@(() => CapNhat(item.SoThuTu))"
                                      title="Cập nhật" />

                    </div>
                </Template>
            </RadzenDataGridColumn>

        </Columns>
    </RadzenDataGrid>
</RadzenCard>



@code {

    //---------- MODEL CLASS ----------

    class DeXuatDto
    {
        public int SoThuTu { get; set; }
        public string TenSangKienCaiTien { get; set; } = string.Empty;
        public string MoTaGoc { get; set; } = string.Empty;
        public string LoaiSangKienCaiTien { get; set; } = string.Empty;
        public string TacGia { get; set; } = string.Empty;
        public DateTime NgayGui { get; set; }
        public int TrangThai { get; set; }
        // 0: Chờ xét duyệt | 1: Được phê duyệt | 2: Không phê duyệt
        public bool CoThongBao { get; set; }
    }

    //---------- PROPERTIES ----------

    List<DeXuatDto> dsDeXuat = new();

    //---------- LIFECYCLE METHODS ----------

    protected override void OnInitialized()
    {
        // Khởi tạo dữ liệu
        dsDeXuat = new List<DeXuatDto>
        {
            new DeXuatDto
            {
                SoThuTu = 1,
                TenSangKienCaiTien = "Giáo trình Lập trình Web nâng cao",
                LoaiSangKienCaiTien = "Giáo trình mới",
                TacGia = "TS. Nguyễn Văn A",
                NgayGui = new DateTime(2025, 1, 15),
                TrangThai = 1,
                CoThongBao = false
            },
            new DeXuatDto
            {
                SoThuTu = 2,
                TenSangKienCaiTien = "Tài liệu thực hành Cơ sở dữ liệu",
                LoaiSangKienCaiTien = "Tài liệu dạy học mới",
                TacGia = "PGS.TS. Phạm Thị D",
                NgayGui = new DateTime(2025, 2, 1),
                TrangThai = 0,
                CoThongBao = false
            },
            new DeXuatDto
            {
                SoThuTu = 3,
                TenSangKienCaiTien = "Giáo trình Trí tuệ nhân tạo",
                MoTaGoc = "Gốc: Giáo trình Trí tuệ nhân tạo - Phiên bản 2020",
                LoaiSangKienCaiTien = "Chỉnh lý giáo trình",
                TacGia = "GS.TS. Võ Văn F",
                NgayGui = new DateTime(2025, 1, 20),
                TrangThai = 2,
                CoThongBao = false
            }
        };
    }

    //---------- EVENT HANDLERS ----------

    void XemChiTiet(int soThuTu)
    {
        // Xử lý logic xem chi tiết
        Console.WriteLine($"Xem chi tiết đề xuất số: {soThuTu}");
        // NavigationManager.NavigateTo($"/de-xuat/chi-tiet/{soThuTu}");
    }

    void CapNhat(int soThuTu)
    {
        // Xử lý logic cập nhật
        Console.WriteLine($"Cập nhật đề xuất số: {soThuTu}");
        // NavigationManager.NavigateTo($"/de-xuat/cap-nhat/{soThuTu}");
    }

}

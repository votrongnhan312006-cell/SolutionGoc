@page "/DanhSachDeXuatSkct"
@using QLCongViec.Models.SangKienCaiTien
@using Radzen
@using Radzen.Blazor


<!--==================== PHẦN HTML/MARKUP ====================-->

<RadzenCard Style="padding:20px">
    <h3>Danh sách đề xuất của đơn vị</h3>
    <p style="color:#6c757d;margin-bottom:20px">Theo dõi trạng thái các đề xuất biên soạn đã gửi</p>

    <RadzenDataGrid Data="@lstSangKienCaiTien"
                    TItem="tbSangKienCaiTien"
                    AllowPaging="true"
                    PageSize="10"
                    AllowSorting="true"
                    AllowFiltering="false">

        <Columns>

            <!-- STT -->
            <RadzenDataGridColumn Title="Số thứ tự" Width="80px" TextAlign="TextAlign.Center">
                <Template Context="ctx">
                    @(lstSangKienCaiTien.IndexOf(ctx) + 1)
                </Template>
            </RadzenDataGridColumn>

            <!-- Tên sáng kiến -->
            <RadzenDataGridColumn TItem="tbSangKienCaiTien"
                                  Property="tenSangKienCaiTien"
                                  Title="Tên sáng kiến cải tiến"
                                  Width="300px" />

            <!-- Tác giả -->
            <RadzenDataGridColumn TItem="tbSangKienCaiTien"
                                  Property="tenTacGia"
                                  Title="Tác giả"
                                  Width="180px" />

            <!-- Ngày gửi -->
            <RadzenDataGridColumn TItem="tbSangKienCaiTien"
                                  Property="ngayThucHien"
                                  Title="Ngày thực hiện"
                                  Width="180px" />

            <!-- Trạng thái -->
            <RadzenDataGridColumn Title="Trạng thái" Width="180px" TextAlign="TextAlign.Center">
                <Template Context="ctx">
                    @if (ctx.idTrangThai == 1)
                    {
                        <RadzenBadge Text="Được phê duyệt"
                                     BadgeStyle="BadgeStyle.Success"
                                     Style="padding:8px 12px" />
                    }
                    if (ctx.idTrangThai == 2)
                    {
                    <RadzenBadge Text="Chờ xét duyệt"
                                 BadgeStyle="BadgeStyle.Warning"
                                 Style="padding:8px 12px" />
                    }
                    if (ctx.idTrangThai == 3)
                    {
                    <RadzenBadge Text="Không phê duyệt"
                                 BadgeStyle="BadgeStyle.Danger"
                                 Style="padding:8px 12px" />
                    }
                </Template>
            </RadzenDataGridColumn>

            <!-- Thao tác -->
            <RadzenDataGridColumn Title="Thao tác" Width="160px" TextAlign="TextAlign.Center">
                <Template Context="ctx">
                    <div style="display:flex;gap:5px;justify-content:center">
                        <!-- Nút Xem chi tiết -->
                        <RadzenButton Icon="visibility"
                                      Size="ButtonSize.Small"
                                      ButtonStyle="ButtonStyle.Info"
                                      Variant="Variant.Outlined"
                                      Click="@(() => XemChiTiet(ctx.idSangKienCaiTien))"
                                      title="Chi tiết" />

                    </div>
                </Template>
            </RadzenDataGridColumn>

        </Columns>
    </RadzenDataGrid>
</RadzenCard>


@inject ApiServices apiService
@inject Radzen.DialogService DialogService

@code {
    private List<tbSangKienCaiTien>? lstSangKienCaiTien;


    protected override async Task OnInitializedAsync()
    {
        lstSangKienCaiTien = await apiService.GetAll<tbSangKienCaiTien>();
    }

    private async Task XemChiTiet(long id)
    {
        await DialogService.OpenAsync<ChiTietDeXuat_Dialog>(
            "Chi tiết",
            new Dictionary<string, object> { ["Id"] = id },
            new Radzen.DialogOptions
            {
                Width = "800px",
                Height = "600px",
                Resizable = true,
                Draggable = true,
                CloseDialogOnOverlayClick = true
            }
        );
    }

}
